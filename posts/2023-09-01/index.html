<!DOCTYPE html><html class="has-navbar-fixed-top" lang="zh-CN"><head><meta charset="utf-8"><title>为Hexo博客添加PWA - mykonakona</title><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5"><meta name="theme-color" content="#222f3e"><meta name="description" content="不要再装那些hexo的PWA插件了。"><link rel="icon" href="/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/bulma/0.6.2/css/bulma.min.css"><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.2/styles/atom-one-dark.min.css" media="none" onload='"all"!=media&&(media="all")'><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/lightgallery/1.6.8/css/lightgallery.min.css" media="none" onload='"all"!=media&&(media="all")'><noscript><link rel="stylesheet" href="//cdnjs.loli.net/ajax/libs/lightgallery/1.6.8/css/lightgallery.min.css"></noscript><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="mykonakona" type="application/atom+xml"></head><body><nav class="navbar is-transparent is-fixed-top navbar-main" role="navigation" aria-label="main navigation"><div class="container"><div class="navbar-brand"><a class="navbar-item navbar-logo" href="/">mykonakona</a><div class="navbar-burger"><span></span> <span></span> <span></span></div></div><div class="navbar-menu navbar-start"><a class="navbar-item" href="/archives">归档</a> <a class="navbar-item" href="/tags">标签</a> <a class="navbar-item" href="/about">关于</a></div><div class="navbar-menu navbar-end"><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fa-solid fa-magnifying-glass"></i> </a><a class="navbar-item" title="RSS" href="https://mykonakona.github.io/atom.xml"><i class="fa-solid fa-rss"></i></a></div></div></nav><section class="section"><div class="container"><article class="article content gallery" itemscope itemprop="blogPost"><h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">为Hexo博客添加PWA</h1><div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile"><span class="column is-narrow"><time datetime="2023-09-01T06:12:35.000Z" itemprop="datePublished">9月 1 2023</time> </span><span class="column is-narrow">4 分钟 读完 (约 610 字)</span></div><div class="article-entry is-size-6-mobile" itemprop="articleBody"><html><head></head><body><p>不要再装那些Hexo的PWA插件了。</p><span id="more"></span><p>为Hexo博客添加PWA支持，主要分两部分：</p><h2 id="准备manifest"><a href="#准备manifest" class="headerlink" title="准备manifest"></a>准备manifest</h2><h3 id="制作图标"><a href="#制作图标" class="headerlink" title="制作图标"></a>制作图标</h3><ul><li>制作各种大小的图标并存放在source/images/icons下。</li></ul><h3 id="新增manifest-json"><a href="#新增manifest-json" class="headerlink" title="新增manifest.json"></a>新增manifest.json</h3><ul><li><p>在hexo的source目录下添加一个manifest.json，内容类似：</p><figure class="highlight json hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-punctuation">{</span></span><br><span class="line">   </span><br><span class="line">   &nbsp; &nbsp; <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"mykonakona"</span><span class="hljs-punctuation">,</span></span><br><span class="line">   &nbsp; &nbsp; <span class="hljs-attr">"short_name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"mykonakona"</span><span class="hljs-punctuation">,</span></span><br><span class="line">   &nbsp; &nbsp; <span class="hljs-attr">"theme_color"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"#222f3e"</span><span class="hljs-punctuation">,</span></span><br><span class="line">   &nbsp; &nbsp; <span class="hljs-attr">"background_color"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"#18222d"</span><span class="hljs-punctuation">,</span></span><br><span class="line">   &nbsp; &nbsp; <span class="hljs-attr">"display"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"standalone"</span><span class="hljs-punctuation">,</span></span><br><span class="line">   &nbsp; &nbsp; <span class="hljs-attr">"scope"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"/"</span><span class="hljs-punctuation">,</span></span><br><span class="line">   &nbsp; &nbsp; <span class="hljs-attr">"start_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"/"</span><span class="hljs-punctuation">,</span></span><br><span class="line">   &nbsp; &nbsp; <span class="hljs-attr">"icons"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span></span><br><span class="line">   &nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-punctuation">{</span></span><br><span class="line">   &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="hljs-attr">"src"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"/images/icons/icon-48x48.png"</span><span class="hljs-punctuation">,</span></span><br><span class="line">   &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="hljs-attr">"sizes"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"48x48"</span><span class="hljs-punctuation">,</span></span><br><span class="line">   &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"image/png"</span><span class="hljs-punctuation">,</span></span><br><span class="line">   &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="hljs-attr">"purpose"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"any maskable"</span></span><br><span class="line">   &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span></span><br><span class="line">   &nbsp; &nbsp; &nbsp; &nbsp; ...</span><br><span class="line">   &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="hljs-punctuation">{</span></span><br><span class="line">   &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="hljs-attr">"src"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"/images/icons/icon-512x512.png"</span><span class="hljs-punctuation">,</span></span><br><span class="line">   &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="hljs-attr">"sizes"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"512x512"</span><span class="hljs-punctuation">,</span></span><br><span class="line">   &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"image/png"</span><span class="hljs-punctuation">,</span></span><br><span class="line">   &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="hljs-attr">"purpose"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"any maskable"</span></span><br><span class="line">   &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="hljs-punctuation">}</span></span><br><span class="line">   &nbsp; &nbsp; &nbsp;<span class="hljs-punctuation">]</span></span><br><span class="line">   </span><br><span class="line"><span class="hljs-punctuation">}</span></span><br></pre></td></tr></tbody></table></figure></li></ul><p>图标与json也可以通过类似<a target="_blank" rel="noopener" href="https://tools.crawlink.com/tools/pwa-icon-generator">PWA Application Icon Generator Free Online Tool</a>的在线工具生成。</p><h3 id="修改标签"><a href="#修改标签" class="headerlink" title="修改<head>标签"></a>修改&lt;head&gt;标签</h3><ul><li><p>修改所用hexo主题的模板文件，在head.ejs添加：</p><figure class="highlight html hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"theme-color"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"#222f3e"</span>/&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"manifest"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/manifest.json"</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p>这里<code>theme-color</code>的<code>content</code>值与manifest.json内的值相同。</p></li></ul><h2 id="准备Service-Worker"><a href="#准备Service-Worker" class="headerlink" title="准备Service Worker"></a>准备Service Worker</h2><h3 id="新增service-worker-js"><a href="#新增service-worker-js" class="headerlink" title="新增service-worker.js"></a>新增service-worker.js</h3><ul><li><p>在hexo的source目录下新建一个sw.js文件（需要将正则处的mykonakona.github.io替换为自己的网址）：</p><figure class="highlight javascript hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">importScripts(<span class="hljs-string">'https://cdnjs.cloudflare.com/ajax/libs/workbox-sw/7.0.0/workbox-sw.js'</span>);</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">if</span> (workbox) {</span><br><span class="line"></span><br><span class="line">&nbsp; &nbsp; workbox.<span class="hljs-property">precaching</span>.<span>precache</span>([<span class="hljs-string">'/'</span>, <span class="hljs-string">'/index.html'</span>]);</span><br><span class="line">&nbsp; &nbsp; </span><br><span class="line">&nbsp; &nbsp; workbox.<span class="hljs-property">routing</span>.<span>registerRoute</span>(<span class="hljs-keyword">new</span> <span>RegExp</span>(<span class="hljs-string">'^https?://mykonakona.github.io/?$'</span>), <span class="hljs-keyword">new</span> workbox.<span class="hljs-property">strategies</span>.<span>NetworkFirst</span>());</span><br><span class="line">&nbsp; &nbsp; </span><br><span class="line">&nbsp; &nbsp; workbox.<span class="hljs-property">routing</span>.<span>registerRoute</span>(<span class="hljs-keyword">new</span> <span>RegExp</span>(<span class="hljs-string">'.*.html'</span>), <span class="hljs-keyword">new</span> workbox.<span class="hljs-property">strategies</span>.<span>NetworkFirst</span>());</span><br><span class="line">&nbsp; &nbsp; </span><br><span class="line">&nbsp; &nbsp; workbox.<span class="hljs-property">routing</span>.<span>registerRoute</span>(<span class="hljs-keyword">new</span> <span>RegExp</span>(<span class="hljs-string">'.*.(?:js|css|jpg|png|gif)'</span>), <span class="hljs-keyword">new</span> workbox.<span class="hljs-property">strategies</span>.<span>StaleWhileRevalidate</span>());</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></li></ul><p>NetworkFirst()与StaleWhileRevalidate()的使用，可参考<a target="_blank" rel="noopener" href="https://github.com/GoogleChrome/workbox">workbox</a>的相关文档与教程。</p><h3 id="注册service-worker"><a href="#注册service-worker" class="headerlink" title="注册service-worker"></a>注册service-worker</h3><ul><li><p>修改所用hexo主题的模板文件，在footer后的style.ejs添加注册service-worker的代码段：</p><figure class="highlight html hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="hljs-language-javascript"></span></span><br><span class="line"><span class="hljs-language-javascript">&nbsp; &nbsp; <span class="hljs-keyword">if</span> (navigator.<span class="hljs-property">serviceWorker</span>) {</span></span><br><span class="line"><span class="hljs-language-javascript">&nbsp; &nbsp; navigator.<span class="hljs-property">serviceWorker</span>.<span>register</span>(<span class="hljs-string">'/sw.js'</span>);</span></span><br><span class="line"><span class="hljs-language-javascript">   }</span></span><br><span class="line"><span class="hljs-language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure></li></ul><h3 id="设置不渲染"><a href="#设置不渲染" class="headerlink" title="设置不渲染"></a>设置不渲染</h3><ul><li><p>在hexo的_config.yml里，设置不渲染manifiest.json及sw.js：</p><figure class="highlight yml hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-attr">skip_render:</span></span><br><span class="line">&nbsp;<span class="hljs-bullet">-</span> <span class="hljs-string">manifest.json</span></span><br><span class="line">&nbsp;<span class="hljs-bullet">-</span> <span class="hljs-string">sw.js</span></span><br></pre></td></tr></tbody></table></figure></li></ul><h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>PWA其实用处不大，添加这个主要是为了跑<a href="https://mykonakona.github.io/posts/2023-08-29/">Lighthouse得分</a>。过程中意识到Hexo确实用的人越来越少了：很多插件缺乏维护，照搬文档还不如手工添加。</p><p>硬着头皮补课，网上的sw.js例子调试时报错频频。发现是因为最新的workbox-sw.js里，函数命名从<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/zh-hans/%E9%A7%9D%E5%B3%B0%E5%BC%8F%E5%A4%A7%E5%B0%8F%E5%AF%AB">小驼峰式</a>改成了大驼峰式。比如旧版本例子里的networkFist()如今都变成了NetworkFirst()。看来谷歌也要面对项目管理问题……</p><p>这个简单教程还是有一些前提的，比如PWA需要https支持等，这里不再赘述。</p></body></html></div><div class="columns is-variable is-1 is-multiline is-mobile"><span class="column is-narrow"><a class="tag is-light article-tag" href="/tags/%E9%9D%99%E6%80%81%E5%8D%9A%E5%AE%A2/">#静态博客</a></span> <span class="column is-narrow"><a class="tag is-light article-tag" href="/tags/Hexo/">#Hexo</a></span> <span class="column is-narrow"><a class="tag is-light article-tag" href="/tags/PWA/">#PWA</a></span> <span class="column is-narrow"><a class="tag is-light article-tag" href="/tags/Service-Worker/">#Service Worker</a></span></div><div class="columns is-mobile is-multiline article-nav"><span class="column is-12-mobile is-half-desktop is-hidden-mobile article-nav-prev"></span> <span class="column is-12-mobile is-half-desktop article-nav-next"><a href="/posts/2023-08-29/">如何添加Lighthouse徽章</a></span></div></article><div class="comments"><h3 class="title is-4">评论</h3><script src="https://giscus.app/client.js" data-repo="mykonakona/mykonakona.github.io" data-repo-id="MDEwOlJlcG9zaXRvcnkxMzM0NDI4Njc=" data-category="Announcements" data-category-id="DIC_kwDOB_QtM84CUfUd" data-mapping="url" data-strict="0" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="dark" data-lang="zh-CN" data-loading="lazy" crossorigin="anonymous" async></script></div></div></section><footer class="footer"><div class="container"><div class="columns content"><div class="column is-narrow has-text-centered">&copy; 2023 mykonakona &nbsp; Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> & <a target="_blank" rel="noopener" href="http://github.com/ppoffice/hexo-theme-minos">Minos</a></div><div class="column is-narrow has-text-centered"><a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">CC BY-NC-SA 4.0</a></div><div class="column is-hidden-mobile"></div></div></div></footer><script src="//cdnjs.loli.net/ajax/libs/jquery/3.7.1/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/dayjs@1/dayjs.min.js"></script><script src="https://cdn.jsdelivr.net/npm/dayjs@1/plugin/relativeTime.min.js"></script><script>dayjs.extend(window.dayjs_plugin_relativeTime)</script><script src="https://cdn.jsdelivr.net/npm/dayjs@1/locale/zh-cn.js"></script><script>dayjs.locale("zh-cn")</script><script>navigator.serviceWorker&&navigator.serviceWorker.register("/sw.js")</script><script src="//cdnjs.cloudflare.com/ajax/libs/lightgallery/1.6.8/js/lightgallery-all.min.js"></script><script>!function(e){e(document).ready(function(){"function"==typeof e.fn.lightGallery&&e(".article.gallery").lightGallery({selector:".gallery-item"})})}(jQuery)</script><script defer src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script><style>.hljs{position:relative}.hljs .clipboard-btn{float:right;color:#9a9a9a;background:0 0;border:none;cursor:pointer}.hljs .clipboard-btn:hover{color:#8a8a8a}.hljs>.clipboard-btn{display:none;position:absolute;right:4px;top:4px}.hljs:hover>.clipboard-btn{display:inline}.hljs>figcaption>.clipboard-btn{margin-right:4px}</style><script>$(document).ready(function(){$("figure.hljs").each(function(t,e){var t="code-"+t,a=e.querySelector(".code"),r=$('<button>Copy <i class="far fa-clipboard"></i></button>'),a=(a.id=t,r.addClass("clipboard-btn"),r.attr("data-clipboard-target-id",t),e.querySelector("figcaption"));a?a.append(r[0]):e.prepend(r[0])}),new ClipboardJS(".clipboard-btn",{target:function(t){return document.getElementById(t.getAttribute("data-clipboard-target-id"))}}).on("success",function(t){t.clearSelection()})})</script><script src="/js/script.js"></script><div class="searchbox ins-search"><div class="searchbox-mask"></div><div class="searchbox-container ins-search-container"><div class="searchbox-input-wrapper"><input type="text" class="searchbox-input ins-search-input" placeholder="站内搜索"> <span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span></div><div class="searchbox-result-wrapper ins-section-wrapper"><div class="ins-section-container"></div></div></div></div><script>window.INSIGHT_CONFIG={TRANSLATION:{POSTS:"文章",PAGES:"页面",CATEGORIES:"分类",TAGS:"标签",UNTITLED:"(无标题)"},CONTENT_URL:"/content.json"}</script><script src="/js/insight.js"></script></body></html>