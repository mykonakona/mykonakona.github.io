<!DOCTYPE html>
<html data-theme="" lang="zh-CN">
<head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="/css/main.css">
 
<meta name="generator" content="Hexo 7.3.0"></head>
    <!-- 响应式导航栏 -->
<div class="navbar bg-base-200 lg:hidden">
  <div class="navbar-start">
      <div tabindex="0" role="button" class="btn btn-ghost btn-circle avatar">
          <div class="w-10 rounded-full">
            <img alt="Tailwind CSS Navbar component" src="/images/icons/icon-152x152.png" />                    
          </div>
      </div>
  </div>
  <div class="navbar-center">
      <a href="/" class="btn btn-ghost text-xl">
          mykonakona&#39;s weblog
      </a>
  </div>
  <div class="navbar-end">
      <div class="dropdown dropdown-left">
      <div tabindex="0" role="button" class="btn btn-ghost btn-circle">
          <svg
          xmlns="http://www.w3.org/2000/svg"
          fill="none"
          viewBox="0 0 24 24"
          class="inline-block h-5 w-5 stroke-current">
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M4 6h16M4 12h16M4 18h16"></path>
          </svg>
      </div>
      <ul tabindex="0" class="menu menu-lg dropdown-content bg-base-100 rounded-box z-[1] mt-3 w-52 p-2 shadow">
          
              <li>
                <a href="/">Home</a>
              </li>
          
              <li>
                <a href="/archives/">Archives</a>
              </li>
          
              <li>
                <a href="/categories/">Categories</a>
              </li>
          
              <li>
                <a href="/tags/">Tags</a>
              </li>
          
              <li>
                <a href="/about/">About</a>
              </li>
          
      </ul>
      </div>
  </div>
</div>
<!-- 响应式导航栏结束 -->
<body>
    <div class="drawer lg:drawer-open">
        <input id="my-drawer-3" type="checkbox" class="drawer-toggle" />
        <div class="drawer-side">
            <label for="my-drawer-3" aria-label="close sidebar" class="drawer-overlay"></label>
            <ul class="menu bg-base-300 text-base-content min-h-full w-80 p-8">
                <div class="flex flex-row items-center mx-auto">
                    <div class="avatar py-4">
                      <div class="w-24 rounded-full">
                        <img alt="Tailwind CSS Navbar component" src="/images/icons/icon-512x512.png" />     
                      </div>
                    </div>
                </div>     

                
                    <li class="hover:text-white transition duration-200 ease-in-out">
                      <a class="px-4 py-2 text-xl" href="/">Home</a>
                    </li>
                
                    <li class="hover:text-white transition duration-200 ease-in-out">
                      <a class="px-4 py-2 text-xl" href="/archives/">Archives</a>
                    </li>
                
                    <li class="hover:text-white transition duration-200 ease-in-out">
                      <a class="px-4 py-2 text-xl" href="/categories/">Categories</a>
                    </li>
                
                    <li class="hover:text-white transition duration-200 ease-in-out">
                      <a class="px-4 py-2 text-xl" href="/tags/">Tags</a>
                    </li>
                
                    <li class="hover:text-white transition duration-200 ease-in-out">
                      <a class="px-4 py-2 text-xl" href="/about/">About</a>
                    </li>
                
            </ul>
        </div>
        <div class="drawer-content bg-base-200 flex flex-col">          
        <!-- Page content here -->
        <!-- Page Content-->
        <main class="flex-1 min-h-[80vh] w-full p-4">
            
    <div class="mx-auto lg:p-4">
        <div class="card mx-auto lg:bg-base-100 max-w-5xl">
            <div class="card-title">    
            </div>
            <div class="card-body w-full mx-auto">
                <article class="prose max-w-4xl">
                    <div class="mb-4 text-3xl font-bold">
                            Hexo手动添加PWA

                        </div>
                        <div class="text-base">
                            2023-09-01
                        </div>
                        <div class="text-base">
                            <p>不要再装那些Hexo的PWA插件了。</p>
<span id="more"></span>

<p>为Hexo博客添加PWA支持，主要分两部分：</p>
<h2 id="准备manifest"><a href="#准备manifest" class="headerlink" title="准备manifest"></a>准备manifest</h2><h3 id="制作图标"><a href="#制作图标" class="headerlink" title="制作图标"></a>制作图标</h3><ul>
<li>制作各种大小的图标并存放在source&#x2F;images&#x2F;icons下。</li>
</ul>
<h3 id="新增manifest-json"><a href="#新增manifest-json" class="headerlink" title="新增manifest.json"></a>新增manifest.json</h3><ul>
<li><p>在hexo的source目录下添加一个manifest.json，内容类似：</p>
<pre><code class="json">   &#123;

    &quot;name&quot;: &quot;mykonakona&quot;,
    &quot;short_name&quot;: &quot;mykonakona&quot;,
    &quot;theme_color&quot;: &quot;#222f3e&quot;,
    &quot;background_color&quot;: &quot;#18222d&quot;,
    &quot;display&quot;: &quot;standalone&quot;,
    &quot;scope&quot;: &quot;/&quot;,
    &quot;start_url&quot;: &quot;/&quot;,
    &quot;icons&quot;: [
        &#123;
         &quot;src&quot;: &quot;/images/icons/icon-48x48.png&quot;,
         &quot;sizes&quot;: &quot;48x48&quot;,
         &quot;type&quot;: &quot;image/png&quot;,
         &quot;purpose&quot;: &quot;any maskable&quot;
         &#125;,
        ...
         &#123;
         &quot;src&quot;: &quot;/images/icons/icon-512x512.png&quot;,
         &quot;sizes&quot;: &quot;512x512&quot;,
         &quot;type&quot;: &quot;image/png&quot;,
         &quot;purpose&quot;: &quot;any maskable&quot;
         &#125;
     ]

   &#125;
</code></pre>
</li>
</ul>
<p>图标与json也可以通过类似<a target="_blank" rel="noopener" href="https://tools.crawlink.com/tools/pwa-icon-generator">PWA Application Icon Generator Free Online Tool</a>的在线工具生成。</p>
<h3 id="修改标签"><a href="#修改标签" class="headerlink" title="修改&lt;head&gt;标签"></a>修改&lt;head&gt;标签</h3><ul>
<li><p>修改所用hexo主题的模板文件，在head.ejs添加：</p>
<pre><code class="html">&lt;meta name=&quot;theme-color&quot; content=&quot;#222f3e&quot;/&gt;
&lt;link rel=&quot;manifest&quot; href=&quot;/manifest.json&quot;&gt;
</code></pre>
<p> 这里<code>theme-color</code>的<code>content</code>值与manifest.json内的值相同。</p>
</li>
</ul>
<h2 id="准备Service-Worker"><a href="#准备Service-Worker" class="headerlink" title="准备Service Worker"></a>准备Service Worker</h2><h3 id="新增service-worker-js"><a href="#新增service-worker-js" class="headerlink" title="新增service-worker.js"></a>新增service-worker.js</h3><ul>
<li><p>在hexo的source目录下新建一个sw.js文件（需要将正则处的mykonakona.github.io替换为自己的网址）：</p>
<pre><code class="javascript">importScripts(&#39;https://cdnjs.cloudflare.com/ajax/libs/workbox-sw/7.0.0/workbox-sw.js&#39;);

if (workbox) &#123;

    workbox.precaching.precache([&#39;/&#39;, &#39;/index.html&#39;]);
    
    workbox.routing.registerRoute(new RegExp(&#39;^https?://mykonakona.github.io/?$&#39;), new workbox.strategies.NetworkFirst());
    
    workbox.routing.registerRoute(new RegExp(&#39;.*.html&#39;), new workbox.strategies.NetworkFirst());
    
    workbox.routing.registerRoute(new RegExp(&#39;.*.(?:js|css|jpg|png|gif)&#39;), new workbox.strategies.StaleWhileRevalidate());
&#125;
</code></pre>
</li>
</ul>
<p>NetworkFirst()与StaleWhileRevalidate()的使用，可参考<a target="_blank" rel="noopener" href="https://github.com/GoogleChrome/workbox">workbox</a>的相关文档与教程。</p>
<h3 id="注册service-worker"><a href="#注册service-worker" class="headerlink" title="注册service-worker"></a>注册service-worker</h3><ul>
<li><p>修改所用hexo主题的模板文件，在footer后的style.ejs添加注册service-worker的代码段：</p>
<pre><code class="html">&lt;script&gt;
    if (navigator.serviceWorker) &#123;
    navigator.serviceWorker.register(&#39;/sw.js&#39;);
   &#125;
&lt;/script&gt;
</code></pre>
</li>
</ul>
<h3 id="设置不渲染"><a href="#设置不渲染" class="headerlink" title="设置不渲染"></a>设置不渲染</h3><ul>
<li><p>在hexo的_config.yml里，设置不渲染manifiest.json及sw.js：</p>
<pre><code class="yml">skip_render:
 - manifest.json
 - sw.js
</code></pre>
</li>
</ul>
<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>PWA其实用处不大，添加这个主要是为了跑Lighthouse分。过程中意识到Hexo确实用的人越来越少了：很多插件缺乏维护，照搬文档还不如手工添加。</p>
<p>硬着头皮补课，网上的sw.js例子调试时报错频频。发现是因为最新的workbox-sw.js里，函数命名从<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/zh-hans/%E9%A7%9D%E5%B3%B0%E5%BC%8F%E5%A4%A7%E5%B0%8F%E5%AF%AB">小驼峰式</a>改成了大驼峰式。比如旧版本例子里的networkFist()如今都变成了NetworkFirst()。看来谷歌也要面对项目管理问题……</p>
<p>这个简单教程还是有一些前提的，比如PWA需要https支持等，这里不再赘述。</p>
     
                        </div>             
                </article>
            </div>
        </div>
    </div>



             
        </main>
        <footer class="flex-none footer bg-base-200 text-base-content border-t border-base-300 px-10 py-4 min-h-12">
  <aside class="grid-flow-col items-center">
    <svg class="items-center" width="24" height="24" viewBox="0 0 1024 1024" fill="fill-current" xmlns="http://www.w3.org/2000/svg">
      <rect x="256" y="670.72" width="512" height="256" rx="128" fill="#1AD1A5"/>
      <circle cx="512" cy="353.28" r="256" fill="white"/>
      <circle cx="512" cy="353.28" r="261" stroke="black" stroke-opacity="0.2" stroke-width="10"/>
      <circle cx="512" cy="353.28" r="114.688" fill="#FF9903"/>
    </svg>
    <p>
      Copyright © 2024 - All right reserved
      <br />
      Powered by daisyUI
    </p>
  </aside>
  <nav class="md:place-self-center md:justify-self-end">
    <div class="grid grid-flow-col gap-4">
    </div>
  </nav>
</footer>
        <!-- Page Content结束-->
        </div>        
    </div>
</body>
</html>


