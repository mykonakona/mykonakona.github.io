<!DOCTYPE html>
<html data-theme="" lang="zh-CN">
<head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="/css/main.css">
 
<link rel="stylesheet" href="https://cdn.hugeicons.com/font/hgi-stroke-rounded.css" />
<link rel="preload" href="https://webfonts-seven.vercel.app/noto-sans-sc-v36-chinese-simplified_latin-regular.woff2" as="font" type="font/woff2" crossorigin>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.26.0/themes/prism-okaidia.min.css"/>
<meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="mykonakona's weblog" type="application/atom+xml">
</head>
    <!-- 响应式导航栏 -->
<div class="navbar bg-base-200 lg:hidden">
  <div class="navbar-start">
      <div tabindex="0" role="button" class="btn btn-ghost btn-circle avatar">
          <div class="w-10 rounded-full">
            <img alt="Tailwind CSS Navbar component" src="/images/icons/icon-152x152.png" />                    
          </div>
      </div>
  </div>
  <div class="navbar-center">
      <a href="/" class="btn btn-ghost text-xl">
          mykonakona&#39;s weblog
      </a>
  </div>
  <div class="navbar-end">
      <div class="dropdown dropdown-left">
      <div tabindex="0" role="button" class="btn btn-ghost btn-circle">
          <svg
          xmlns="http://www.w3.org/2000/svg"
          fill="none"
          viewBox="0 0 24 24"
          class="inline-block h-5 w-5 stroke-current">
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M4 6h16M4 12h16M4 18h16"></path>
          </svg>
      </div>
      <ul tabindex="0" class="menu menu-lg dropdown-content bg-base-200 rounded-box z-[1] mt-3 w-52 p-2 shadow">
          
              <li>
                <a href="/">Home</a>
              </li>
          
              <li>
                <a href="/archives/">Archives</a>
              </li>
          
              <li>
                <a href="/categories/">Categories</a>
              </li>
          
              <li>
                <a href="/tags/">Tags</a>
              </li>
          
              <li>
                <a href="/about/">About</a>
              </li>
          
      </ul>
      </div>
  </div>
</div>
<!-- 响应式导航栏结束 -->
<body>
    <div class="drawer lg:drawer-open">
        <input id="my-drawer-3" type="checkbox" class="drawer-toggle" />
        <div class="drawer-side">
            <label for="my-drawer-3" aria-label="close sidebar" class="drawer-overlay"></label>
            <ul class="menu bg-base-300 text-base-content min-h-full w-80 pt-20 px-8">
                <div class="mx-auto">
                    <div class="avatar pb-4">
                      <div class="w-36 rounded-full">
                        <img alt="Tailwind CSS Navbar component" src="/images/icons/icon-284x284.png" />     
                      </div>
                    </div>
                </div>
                <div class="text-xl font-normal mx-auto">
                mykonakona
                </div>
                <div class="text-base font-light mx-auto pb-4">
                Just Another Weblog
                </div>
                 <div class="flex justify-around py-4">
                    <a target="_blank" rel="noopener" href="https://github.com/mykonakona">
                        <i class="hgi hgi-stroke hgi-github" style="font-size:2rem"></i>
                    </a>
                    <a target="_blank" rel="noopener" href="https://x.com/mykonakona">
                        <i class="hgi hgi-stroke hgi-new-twitter" style="font-size:2rem"></i>
                    </a>
                    <a href="https://mykonakona.github.io/atom.xml">
                    <i class="hgi hgi-stroke hgi-rss" style="font-size:2rem"></i>
                    </a>                 
                </div>   
                
                    <li class="hover:text-white transition duration-200 ease-in-out">
                      <a class="px-4 py-2 text-xl" href="/">Home</a>
                    </li>
                
                    <li class="hover:text-white transition duration-200 ease-in-out">
                      <a class="px-4 py-2 text-xl" href="/archives/">Archives</a>
                    </li>
                
                    <li class="hover:text-white transition duration-200 ease-in-out">
                      <a class="px-4 py-2 text-xl" href="/categories/">Categories</a>
                    </li>
                
                    <li class="hover:text-white transition duration-200 ease-in-out">
                      <a class="px-4 py-2 text-xl" href="/tags/">Tags</a>
                    </li>
                
                    <li class="hover:text-white transition duration-200 ease-in-out">
                      <a class="px-4 py-2 text-xl" href="/about/">About</a>
                    </li>
                
            </ul>
        </div>
        <div class="drawer-content bg-base-200 flex flex-col">          
        <!-- Page content here -->
        <!-- Page Content-->
        <main class="flex-1 min-h-[85vh] w-full px-4 py-4">
            
<div class="mx-auto lg:p-4">
  <div class="card mx-auto lg:bg-base-100 max-w-5xl">
    <div class="card-title">
    </div>
    <div class="card-body w-full mx-auto">
      <article class="prose max-w-5xl pb-4">
        <div class="mb-4 text-3xl font-bold">
          Hexo手动添加PWA

        </div>
        <div class="text-base">
          2023-09-01
        </div>
        <div class="text-base">
          <p>不要再装那些Hexo的PWA插件了。</p>
<span id="more"></span>

<p>为Hexo博客添加PWA支持，主要分两部分：</p>
<h2 id="准备manifest"><a href="#准备manifest" class="headerlink" title="准备manifest"></a>准备manifest</h2><h3 id="制作图标"><a href="#制作图标" class="headerlink" title="制作图标"></a>制作图标</h3><ul>
<li>制作各种大小的图标并存放在source&#x2F;images&#x2F;icons下。</li>
</ul>
<h3 id="新增manifest-json"><a href="#新增manifest-json" class="headerlink" title="新增manifest.json"></a>新增manifest.json</h3><ul>
<li><p>在hexo的source目录下添加一个manifest.json，内容类似：</p>
 <pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
   
       <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"mykonakona"</span><span class="token punctuation">,</span>
       <span class="token property">"short_name"</span><span class="token operator">:</span> <span class="token string">"mykonakona"</span><span class="token punctuation">,</span>
       <span class="token property">"theme_color"</span><span class="token operator">:</span> <span class="token string">"#222f3e"</span><span class="token punctuation">,</span>
       <span class="token property">"background_color"</span><span class="token operator">:</span> <span class="token string">"#18222d"</span><span class="token punctuation">,</span>
       <span class="token property">"display"</span><span class="token operator">:</span> <span class="token string">"standalone"</span><span class="token punctuation">,</span>
       <span class="token property">"scope"</span><span class="token operator">:</span> <span class="token string">"/"</span><span class="token punctuation">,</span>
       <span class="token property">"start_url"</span><span class="token operator">:</span> <span class="token string">"/"</span><span class="token punctuation">,</span>
       <span class="token property">"icons"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
           <span class="token punctuation">&#123;</span>
            <span class="token property">"src"</span><span class="token operator">:</span> <span class="token string">"/images/icons/icon-48x48.png"</span><span class="token punctuation">,</span>
            <span class="token property">"sizes"</span><span class="token operator">:</span> <span class="token string">"48x48"</span><span class="token punctuation">,</span>
            <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"image/png"</span><span class="token punctuation">,</span>
            <span class="token property">"purpose"</span><span class="token operator">:</span> <span class="token string">"any maskable"</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
           ...
            <span class="token punctuation">&#123;</span>
            <span class="token property">"src"</span><span class="token operator">:</span> <span class="token string">"/images/icons/icon-512x512.png"</span><span class="token punctuation">,</span>
            <span class="token property">"sizes"</span><span class="token operator">:</span> <span class="token string">"512x512"</span><span class="token punctuation">,</span>
            <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"image/png"</span><span class="token punctuation">,</span>
            <span class="token property">"purpose"</span><span class="token operator">:</span> <span class="token string">"any maskable"</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">]</span>
   
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ul>
<p>图标与json也可以通过类似<a target="_blank" rel="noopener" href="https://tools.crawlink.com/tools/pwa-icon-generator">PWA Application Icon Generator Free Online Tool</a>的在线工具生成。</p>
<h3 id="修改标签"><a href="#修改标签" class="headerlink" title="修改&lt;head&gt;标签"></a>修改&lt;head&gt;标签</h3><ul>
<li><p>修改所用hexo主题的模板文件，在head.ejs添加：</p>
 <pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>theme-color<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#222f3e<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>manifest<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/manifest.json<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p> 这里<code>theme-color</code>的<code>content</code>值与manifest.json内的值相同。</p>
</li>
</ul>
<h2 id="准备Service-Worker"><a href="#准备Service-Worker" class="headerlink" title="准备Service Worker"></a>准备Service Worker</h2><h3 id="新增service-worker-js"><a href="#新增service-worker-js" class="headerlink" title="新增service-worker.js"></a>新增service-worker.js</h3><ul>
<li><p>在hexo的source目录下新建一个sw.js文件（需要将正则处的mykonakona.github.io替换为自己的网址）：</p>
 <pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">importScripts</span><span class="token punctuation">(</span><span class="token string">'https://cdnjs.cloudflare.com/ajax/libs/workbox-sw/7.0.0/workbox-sw.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>workbox<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

    workbox<span class="token punctuation">.</span>precaching<span class="token punctuation">.</span><span class="token function">precache</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token string">'/index.html'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    workbox<span class="token punctuation">.</span>routing<span class="token punctuation">.</span><span class="token function">registerRoute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span><span class="token string">'^https?://mykonakona.github.io/?$'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">workbox<span class="token punctuation">.</span>strategies<span class="token punctuation">.</span>NetworkFirst</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    workbox<span class="token punctuation">.</span>routing<span class="token punctuation">.</span><span class="token function">registerRoute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span><span class="token string">'.*.html'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">workbox<span class="token punctuation">.</span>strategies<span class="token punctuation">.</span>NetworkFirst</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    workbox<span class="token punctuation">.</span>routing<span class="token punctuation">.</span><span class="token function">registerRoute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span><span class="token string">'.*.(?:js|css|jpg|png|gif)'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">workbox<span class="token punctuation">.</span>strategies<span class="token punctuation">.</span>StaleWhileRevalidate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ul>
<p>NetworkFirst()与StaleWhileRevalidate()的使用，可参考<a target="_blank" rel="noopener" href="https://github.com/GoogleChrome/workbox">workbox</a>的相关文档与教程。</p>
<h3 id="注册service-worker"><a href="#注册service-worker" class="headerlink" title="注册service-worker"></a>注册service-worker</h3><ul>
<li><p>修改所用hexo主题的模板文件，在footer后的style.ejs添加注册service-worker的代码段：</p>
 <pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">
    <span class="token keyword">if</span> <span class="token punctuation">(</span>navigator<span class="token punctuation">.</span>serviceWorker<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    navigator<span class="token punctuation">.</span>serviceWorker<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token string">'/sw.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">&#125;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ul>
<h3 id="设置不渲染"><a href="#设置不渲染" class="headerlink" title="设置不渲染"></a>设置不渲染</h3><ul>
<li><p>在hexo的_config.yml里，设置不渲染manifiest.json及sw.js：</p>
 <pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">skip_render</span><span class="token punctuation">:</span>
 <span class="token punctuation">-</span> manifest.json
 <span class="token punctuation">-</span> sw.js<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li>
</ul>
<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>PWA其实用处不大，添加这个主要是为了跑Lighthouse分。过程中意识到Hexo确实用的人越来越少了：很多插件缺乏维护，照搬文档还不如手工添加。</p>
<p>硬着头皮补课，网上的sw.js例子调试时报错频频。发现是因为最新的workbox-sw.js里，函数命名从<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/zh-hans/%E9%A7%9D%E5%B3%B0%E5%BC%8F%E5%A4%A7%E5%B0%8F%E5%AF%AB">小驼峰式</a>改成了大驼峰式。比如旧版本例子里的networkFist()如今都变成了NetworkFirst()。看来谷歌也要面对项目管理问题……</p>
<p>这个简单教程还是有一些前提的，比如PWA需要https支持等，这里不再赘述。</p>

        </div>
      </article>
      <script src="https://giscus.app/client.js"
    data-repo="mykonakona/mykonakona.github.io"
    data-repo-id="MDEwOlJlcG9zaXRvcnkxMzM0NDI4Njc="
    data-category="Announcements"
    data-category-id="DIC_kwDOB_QtM84CUfUd"
    data-mapping="url"
    data-strict="0"
    data-reactions-enabled="1"
    data-emit-metadata="0"
    data-input-position="top"
    data-theme="light"
    data-lang="zh-CN"
    data-loading="lazy"
    crossorigin="anonymous"
    async>
</script>
    </div>
  </div>
</div>
             
        </main>
        <footer class="flex-none footer bg-base-200 text-base-content border-t border-base-300 px-10 py-4 min-h-12">
  <aside class="grid-flow-col items-center">
    <svg class="items-center" width="24" height="24" viewBox="0 0 1024 1024" fill="fill-current" xmlns="http://www.w3.org/2000/svg">
      <rect x="256" y="670.72" width="512" height="256" rx="128" fill="#1AD1A5"/>
      <circle cx="512" cy="353.28" r="256" fill="white"/>
      <circle cx="512" cy="353.28" r="261" stroke="black" stroke-opacity="0.2" stroke-width="10"/>
      <circle cx="512" cy="353.28" r="114.688" fill="#FF9903"/>
    </svg>
    <p>
      Copyright © 2024 - All right reserved
      <br />
      Powered by daisyUI
    </p>
  </aside>
  <nav class="md:place-self-center md:justify-self-end">
    <div class="grid grid-flow-col gap-4">
    </div>
  </nav>
</footer>
        <!-- Page Content结束-->
        </div>        
    </div>
</body>
</html>


