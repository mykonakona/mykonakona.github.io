<!DOCTYPE html>
<html data-theme="" lang="zh-CN">
<head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="/css/main.css">
 
<meta name="generator" content="Hexo 7.3.0"></head>
    <!-- 响应式导航栏 -->
<div class="navbar bg-base-200 lg:hidden">
  <div class="navbar-start">
      <div tabindex="0" role="button" class="btn btn-ghost btn-circle avatar">
          <div class="w-10 rounded-full">
            <img alt="Tailwind CSS Navbar component" src="/images/icons/icon-152x152.png" />                    
          </div>
      </div>
  </div>
  <div class="navbar-center">
      <a href="/" class="btn btn-ghost text-xl">
          mykonakona&#39;s weblog
      </a>
  </div>
  <div class="navbar-end">
      <div class="dropdown dropdown-left">
      <div tabindex="0" role="button" class="btn btn-ghost btn-circle">
          <svg
          xmlns="http://www.w3.org/2000/svg"
          fill="none"
          viewBox="0 0 24 24"
          class="inline-block h-5 w-5 stroke-current">
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M4 6h16M4 12h16M4 18h16"></path>
          </svg>
      </div>
      <ul tabindex="0" class="menu menu-lg dropdown-content bg-base-100 rounded-box z-[1] mt-3 w-52 p-2 shadow">
          
              <li>
                <a href="/">Home</a>
              </li>
          
              <li>
                <a href="/archives/">Archives</a>
              </li>
          
              <li>
                <a href="/categories/">Categories</a>
              </li>
          
              <li>
                <a href="/tags/">Tags</a>
              </li>
          
              <li>
                <a href="/about/">About</a>
              </li>
          
      </ul>
      </div>
  </div>
</div>
<!-- 响应式导航栏结束 -->
<body>
    <div class="drawer lg:drawer-open">
        <input id="my-drawer-3" type="checkbox" class="drawer-toggle" />
        <div class="drawer-side">
            <label for="my-drawer-3" aria-label="close sidebar" class="drawer-overlay"></label>
            <ul class="menu bg-base-300 text-base-content min-h-full w-80 p-4">
                <div class="flex flex-row items-center mx-auto">
                    <div tabindex="0" role="button" class="btn btn-ghost btn-circle avatar">
                        <div class="w-10 rounded-full">
                          <img alt="Tailwind CSS Navbar component" src="/images/icons/icon-512x512.png" />                                   
                        </div>
                    </div>
                </div>     
                
                    <li class="hover:text-white transition duration-200 ease-in-out">
                      <a class="px-4 py-2 text-xl" href="/">Home</a>
                    </li>
                
                    <li class="hover:text-white transition duration-200 ease-in-out">
                      <a class="px-4 py-2 text-xl" href="/archives/">Archives</a>
                    </li>
                
                    <li class="hover:text-white transition duration-200 ease-in-out">
                      <a class="px-4 py-2 text-xl" href="/categories/">Categories</a>
                    </li>
                
                    <li class="hover:text-white transition duration-200 ease-in-out">
                      <a class="px-4 py-2 text-xl" href="/tags/">Tags</a>
                    </li>
                
                    <li class="hover:text-white transition duration-200 ease-in-out">
                      <a class="px-4 py-2 text-xl" href="/about/">About</a>
                    </li>
                
            </ul>
        </div>
        <div class="drawer-content bg-base-200 flex flex-col">          
        <!-- Page content here -->
        <!-- Page Content-->
        <main class="flex-1 min-h-[80vh] max-w-7xl py-4 lg:p-4">
            
    <div class="mx-auto px-4">
        <article class="mx-auto max-w-7xl prose ">
                <div class="mb-4 text-3xl font-bold">
                    一个Powershell小脚本

                </div>
                <div class="text-base">
                    2017-07-07
                </div>
                <div class="text-base">
                    <p>验证网络打通之余熟悉了Powershell语法。</p>
<span id="more"></span>

<h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>Win环境下可以通过Powershell便捷地进行一些批量操作，如telnet一系列的对端机器。</p>
<p>类似问题可见：</p>
<p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/20583686/automate-telnet-port-testing-on-windows-7-using-batch-script">Automate Telnet Port Testing On Windows 7 Using Batch Script</a></p>
<h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><pre><code class="powershell">#powershell ExecutionPolicy Bypass
#powershell -File ./telnet.ps1

$iplist = Get-Content C:\iplist.txt
$regH = &quot;\b\d&#123;1,3&#125;\.\d&#123;1,3&#125;\.\d&#123;1,3&#125;\.\d&#123;1,3&#125;\b&quot;
$regP = &quot;\s(?&lt;alp&gt;\d&#123;1,5&#125;)&quot;
$remoteHost = &quot;&quot;
$Port = &quot;&quot;
foreach ($i in $iplist)&#123;
    if($i -match $regH)&#123;
        $remoteHost = $Matches[0];
        #write-host &quot;$remoteHost&quot;;
    &#125;
    if($i -match $regP)&#123;
        $Port = $Matches.alp;
        #write-host &quot;$remotePort&quot;;
    &#125;

    try &#123;
        $socket = new-object System.Net.Sockets.TcpClient($remoteHost, $port)
    &#125; catch [Exception] &#123;
        write-host $remoteHost&quot;:&quot;$port &quot;Unconnected`n&quot;
       #write-host $_.Exception.GetType().FullName
       #write-host $_.Exception.Message
        continue
    &#125;
    write-host $remoteHost&quot;:&quot;$port &quot;Connected`n&quot;
&#125;
</code></pre>
<p>其中不同于一般正则的地方的是<code>?&lt;alp&gt;</code>的添加，这部分较通俗的解释可见：<br><a target="_blank" rel="noopener" href="http://blog.csdn.net/bluelilyabc/article/details/17119819">PowerShell中正则表达式的运用</a></p>
<h2 id="执行"><a href="#执行" class="headerlink" title="执行"></a>执行</h2><p>执行该脚本前，将准备好的iplist.txt放到指定路径下（文中指定的路径为C:\iplist.txt），内容大致如下：</p>
<pre><code class="text">127.0.0.1 8080
127.0.0.1 80
</code></pre>
<p>再回到powershell下输入以下命令以获得执行权限。</p>
<pre><code class="bash">powershell ExecutionPolicy Bypass
</code></pre>
<p>获得权限后，输入如下指令执行该脚本文件。</p>
<pre><code class="bash">powershell -File ./telnet.ps1
</code></pre>
<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>该脚本主要包括三部分工作：</p>
<ol>
<li>读入准备好的iplist.txt文件；</li>
<li>使用正则逐行取出需要测试的ip及端口号；</li>
<li>将取出的ip和端口号填入System.Net.Sockets.TcpClient函数中并测试对应的ip及端口。</li>
</ol>
     
                </div>             
        </article>
    </div>



             
        </main>
        <footer class="flex-none footer bg-base-200 text-base-content border-base-300 border-t px-10 py-4 min-h-12">
  <aside class="grid-flow-col items-center">
    <svg class="items-center" width="24" height="24" viewBox="0 0 1024 1024" fill="fill-current" xmlns="http://www.w3.org/2000/svg">
      <rect x="256" y="670.72" width="512" height="256" rx="128" fill="#1AD1A5"/>
      <circle cx="512" cy="353.28" r="256" fill="white"/>
      <circle cx="512" cy="353.28" r="261" stroke="black" stroke-opacity="0.2" stroke-width="10"/>
      <circle cx="512" cy="353.28" r="114.688" fill="#FF9903"/>
    </svg>
    <p>
      Copyright © 2024 - All right reserved
      <br />
      Powered by daisyUI
    </p>
  </aside>
  <nav class="md:place-self-center md:justify-self-end">
    <div class="grid grid-flow-col gap-4">
    </div>
  </nav>
</footer>
        <!-- Page Content结束-->
        </div>        
    </div>
</body>
</html>


