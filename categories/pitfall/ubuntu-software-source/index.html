<!DOCTYPE html>
<html data-theme="" lang="zh-CN">
<head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="/css/main.css">
 
<meta name="generator" content="Hexo 7.3.0"></head>
    <!-- 响应式导航栏 -->
<div class="navbar bg-base-100 lg:hidden">
  <div class="navbar-start">
      <div tabindex="0" role="button" class="btn btn-ghost btn-circle avatar">
          <div class="w-10 rounded-full">
            <img alt="Tailwind CSS Navbar component" src="/images/icons/icon-152x152.png" />                    
          </div>
      </div>
  </div>
  <div class="navbar-center">
      <a href="/" class="btn btn-ghost text-xl">
          mykonakona&#39;s weblog
      </a>
  </div>
  <div class="navbar-end">
      <div class="dropdown dropdown-left">
      <div tabindex="0" role="button" class="btn btn-ghost btn-circle">
          <svg
          xmlns="http://www.w3.org/2000/svg"
          fill="none"
          viewBox="0 0 24 24"
          class="inline-block h-5 w-5 stroke-current">
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M4 6h16M4 12h16M4 18h16"></path>
          </svg>
      </div>
      <ul tabindex="0" class="menu menu-sm dropdown-content bg-base-100 rounded-box z-[1] mt-3 w-52 p-2 shadow">
          
              <li>
                <a href="/">Home</a>
              </li>
          
              <li>
                <a href="/archives/">Archives</a>
              </li>
          
              <li>
                <a href="/categories/">Categories</a>
              </li>
          
              <li>
                <a href="/tags/">Tags</a>
              </li>
          
              <li>
                <a href="/about/">About</a>
              </li>
          
      </ul>
      </div>
  </div>
</div>
<!-- 响应式导航栏结束 -->
<body>
    <div class="drawer lg:drawer-open">
        <input id="my-drawer-3" type="checkbox" class="drawer-toggle" />
        <div class="drawer-side">
            <label for="my-drawer-3" aria-label="close sidebar" class="drawer-overlay"></label>
            <ul class="menu bg-accent text-base-content min-h-full w-80 p-4">
                <div class="flex flex-row items-center mx-auto">
                    <div tabindex="0" role="button" class="btn btn-ghost btn-circle avatar">
                        <div class="w-10 rounded-full">
                          <img alt="Tailwind CSS Navbar component" src="/images/icons/icon-512x512.png" />                                   
                        </div>
                    </div>
                </div>     
                
                    <li class="hover:text-white transition duration-200 ease-in-out">
                      <a class="px-4 py-2 text-xl" href="/">Home</a>
                    </li>
                
                    <li class="hover:text-white transition duration-200 ease-in-out">
                      <a class="px-4 py-2 text-xl" href="/archives/">Archives</a>
                    </li>
                
                    <li class="hover:text-white transition duration-200 ease-in-out">
                      <a class="px-4 py-2 text-xl" href="/categories/">Categories</a>
                    </li>
                
                    <li class="hover:text-white transition duration-200 ease-in-out">
                      <a class="px-4 py-2 text-xl" href="/tags/">Tags</a>
                    </li>
                
                    <li class="hover:text-white transition duration-200 ease-in-out">
                      <a class="px-4 py-2 text-xl" href="/about/">About</a>
                    </li>
                
            </ul>
        </div>
        <div class="drawer-content flex flex-col">          
        <!-- Page content here -->
        <!-- Page Content-->
        <main class="flex-1 min-h-[80vh] max-w-7xl mx-auto py-4 lg:p-4">
            
    <div class="mx-auto px-4">
        <article class="mx-auto max-w-7xl prose ">
                <div class="mb-4 text-3xl font-bold">
                    Ubuntu LTS软件源

                </div>
                <div class="text-base">
                    2021-03-30
                </div>
                <div class="text-base">
                    <p>来自Ubuntu LTS的小意外。</p>
<span id="more"></span>

<h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>为了备份VPS上的docker挂载数据到OneDrive，赶忙安装了restic。restic既有加密又有快照恢复，真是太棒啦！</p>
<p>但执行到<code>restic -r rclone:onedrive:backupfolder init</code>时，突然提示：</p>
<pre><code class="bash">Fatal: create repository at rclone:onedrive:backupfolder failed: invalid backend
</code></pre>
<p>一条简单的命令居然也会报错，这崩得也太快了，还没开始就结束？</p>
<h2 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h2><p>如果这里的backend是invalid的，说明rclone连接有问题。</p>
<p>但实测命令<code>rclone lsd: onedrive</code>，能够正常显示目录结构。连接是有效的。</p>
<h2 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h2><p>restic论坛里提到过类似问题：<a target="_blank" rel="noopener" href="https://forum.restic.net/t/restic-with-rclone/2373/13">restic-with-rclone</a>。</p>
<p>简单总结：根据源码分析，出现这个错误的原因是restic版本过时。备份到OneDrive需要使用rclone，但restic在0.9.0版本里才加入rclone支持。</p>
<p>被安装低版本的原因在于VPS安装的Ubuntu LTS系统，在运行<code>apt-get install resitc</code>后，安装的restic版本号是0.8.3。</p>
<p>本质其实是一个系统运维问题。</p>
<p>对普通用户而言，单台服务器跑跑小程序、代码，没必要追求生产环境的稳定，反而应当尽量与自己的开发、测试环境保持一致，以便于复现、还原异常与报错。</p>
<h2 id="修复"><a href="#修复" class="headerlink" title="修复"></a>修复</h2><p>要想对各类发行版一视同仁地安装restic的最新版本，自己编译是比较稳妥的方案：</p>
<h3 id="安装go环境"><a href="#安装go环境" class="headerlink" title="安装go环境"></a>安装go环境</h3><ul>
<li><p>根据go主页的<a target="_blank" rel="noopener" href="https://golang.org/doc/install">Download and install</a>安装go环境。</p>
</li>
<li><p>下载官方包：</p>
<pre><code class="bash">wget https://github.com/restic/restic/releases/download/v0.12.0/restic-0.12.0.tar.gz
</code></pre>
</li>
<li><p>解压后执行<code>make</code>编译。</p>
</li>
<li><p>配置定时任务</p>
<ul>
<li><p>crontab</p>
<ul>
<li>可以先把<code>RESTIC_PASSWORD=&quot;here is your password&quot;</code>加到<del>&#x2F;.bashrc或者</del>&#x2F;etc&#x2F;profile里</li>
<li>之后<code>crontab -e</code>添加任务配置：</li>
</ul>
</li>
</ul>
<p><code>0 4 * * * . ~/.bashrc; /home/user/restic-0.12.0/restic       -r rclone:onedrivedb:Backup backup /home/usdata; /      home/user/restic-0.12.0/restic forget -q --prune       --keep-hourly 24 --keep-daily 7</code></p>
</li>
</ul>
     
                </div>             
        </article>
    </div>            






             
        </main>
        <footer class="flex-none footer bg-base-100 text-base-content border-base-300 border-t px-10 py-4 min-h-12">
  <aside class="grid-flow-col items-center">
    <svg class="items-center" width="24" height="24" viewBox="0 0 1024 1024" fill="fill-current" xmlns="http://www.w3.org/2000/svg">
      <rect x="256" y="670.72" width="512" height="256" rx="128" fill="#1AD1A5"/>
      <circle cx="512" cy="353.28" r="256" fill="white"/>
      <circle cx="512" cy="353.28" r="261" stroke="black" stroke-opacity="0.2" stroke-width="10"/>
      <circle cx="512" cy="353.28" r="114.688" fill="#FF9903"/>
    </svg>
    <p>
      Copyright © 2024 - All right reserved
      <br />
      Powered by daisyUI
    </p>
  </aside>
  <nav class="md:place-self-center md:justify-self-end">
    <div class="grid grid-flow-col gap-4">
    </div>
  </nav>
</footer>
        <!-- Page Content结束-->
        </div>        
    </div>
</body>
</html>


